<!DOCTYPE html>
<html>
<head>
    <title>Shooting Game Screen</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P" rel="stylesheet">
    <link href="game_screen.css" rel="stylesheet">
</head>
<body>
    <div id = "game-container">
        <canvas width = "1050px" height="700px"></canvas>

        <svg xmlns="http://www.w3.org/2000/svg" id="counter">
            <text x="50%" y="60%">
                TIME:<tspan id="time-remaining">150</tspan>
            </text>
            <text x="13%" y = "60%">
                ACCURACY:<tspan id ="accuracy">0%</tspan>
            </text>
            <text x="87%" y = "50%">
                Your Score:<tspan id ="your-score">0</tspan>
            </text>
            <text x="87%" y = "90%">
                Enemy Score:<tspan id ="your-score">0</tspan>
            </text>
            <text ></text>
        </svg>



        <svg xmlns="http://www.w3.org/2000/svg" id="game-start" display="none">
            <defs>
                <linearGradient id="title-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset = "0%" stop-color="#D8B5FF"/>
                    <stop offset = "100%" stop-color="#1EAE98"/>
                </linearGradient>
            </defs>
            <text id = "match-found" x = "50%" y = "45%">Match Found!</text>
            <text id = "start-message" id x = "50%" y = "50%">
                Game will be starting in
                <tspan id = "count-down">3</tspan>
                !
            </text> 
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" id="game-over" display="none">
            <defs>
                <linearGradient id="game-over-fill" x1="0" y1="0" x2="0" y2="1">
                    <stop offset = "0%" stop-color="#D8B5FF"/>
                    <stop offset = "100%" stop-color="#1EAE98"/>
                </linearGradient>
            </defs>
            <text x="50%" y="50%">
                Game End! Game
                <tspan id="win-lose">draws</tspan>
                !
            </text>
        </svg>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="bounding_box.js"></script>
    <script src="sprite.js"></script>
    <script src="gun.js"></script>
    <script src="game_object.js"></script>
    <script src="ability.js"></script>
    <script>
     $(function() {
        //Get the canvas and 2D content
        const cv = $("canvas").get(0);
        const context = cv.getContext("2d");

        let gameStartTime = 0;


        const totalGameTime = 150;
        const score = 0;

        //Create the game area
        const gameArea = BoundingBox(context, 0, 0, 700, 1050);
        const playerGun = Gun(context, 300, 350, gameArea);
        const objects = [GameObject(context, 0, 0, "gem"),
            GameObject(context, 0, 0, "gem"),
            GameObject(context, 0, 0, "gem")
        ] ;
        const abilitys = [Ability(context, 0, 0,"shootBoost")];
        objects[0].randomize(0);
        objects[1].randomize(1);
        objects[2].randomize(2);
        abilitys[0].randomize();

        function randomization(itemsList)
        {
            for(let i = 0; i < itemsList.length; i++){
                let {x,y} = itemsList[i].getXY();
                if(x <= -100 || x >= 1300 || y >= 900)
                    itemsList[i].randomize(i);
            }
        }

        function doFrame(now){
            if (gameStartTime == 0) gameStartTime = now;

            //Update the time remaining
            const gameTimeSoFar = now - gameStartTime;
            const timeRemaining = Math.ceil((totalGameTime * 1000 - gameTimeSoFar) /1000);

            $("#time-remaining").text(timeRemaining);

            playerGun.update(now);
            objects[0].update();
            objects[1].update();
            objects[2].update();
            abilitys[0].update();
            
            randomization(objects);
            randomization(abilitys);
            context.clearRect(0, 0, cv.width, cv.height);

            playerGun.draw();
            objects[0].draw();
            objects[1].draw();
            objects[2].draw();
            abilitys[0].draw();
            requestAnimationFrame(doFrame);
        }



        $(document).on("keydown", function(event) {
            if(event.keyCode == "37"){
                playerGun.move(1);
            }
            else if(event.keyCode == "38"){
                playerGun.move(2);
            }
            else if(event.keyCode == "39"){
                playerGun.move(3);
            }
            else if (event.keyCode == "40"){
                playerGun.move(4);
            }
            else if (event.keyCode == "32"){
                playerGun.shoot();
            }
        });

        /* Handle the keyup of arrow keys and spacebar */
        $(document).on("keyup", function(event) {
            if(event.keyCode == "37"){
                playerGun.stop(1);
            }
            else if(event.keyCode == "38"){
                playerGun.stop(2);
            }
            else if(event.keyCode == "39"){
                playerGun.stop(3);
            }
            else if (event.keyCode == "40"){
                playerGun.stop(4);
            }
        });

        requestAnimationFrame(doFrame);

    });
    </script>
</body>
</html>